<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../mercury-paginator/mercury-paginator.html">
<link rel="import" href="../paper-input/paper-input.html">

<!--
`oc-grid-controls`
A wrapper component to add search and pagination functionality to data tables on the Ordercloud platform

@demo demo/index.html
-->

<dom-module id="oc-grid-controls">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <paper-input label="Filter" always-float-label value="{{filter}}"></paper-input>

    <content id="myContent"></content>

    <mercury-paginator perpage="1" items="{{items}}"></mercury-paginator>
  </template>

  <script>
    Polymer({

      is: 'oc-grid-controls',

      properties: {
        filterObj : {
          type: Object,
          notify: true,
          value: function(){
            return {}
          }
        },
        filter : {
          type: String,
          value : function(){
            return ""
          },
          observer: "_filterHandler"
        },
        data : {
          type: Array,
          value: function(){
            return []
          },
          observer: "_dataChanged"
        },
        totalPages: {
          type: Number
        },
        itemsToDisplay : {
          type: Array,
          value: function(){
            return []
          }
        }

      },

      listeners : {
        "data-capture" : "_dataHandler"
      },

      _filterHandler : function(filterValue){
        this.filterObj = [{"path" : "name"}, {"path" : "displayName"}];

        for(var i=0; i<this.filterObj.length; i++){
          this.filterObj[i].filter = filterValue || "";
        }

        var effectiveChildren = this.getContentChildren('#myContent');
        effectiveChildren[0].filter = this.filterObj;
//        console.log(effectiveChildren);

      },

      _dataChanged: function(data){
        var element = this.$$('mercury-paginator');
        element.data = this.data;
        console.log(element.itemsToDisplay);

        var effectiveChildren = this.getContentChildren('#myContent');
        if (data.length) {
          effectiveChildren[0].items = element.items;
        }


      },

      ready : function() {
//        var effectiveChildren = this.getContentChildren('#myContent');
//        effectiveChildren[0].items = this.data;
//        console.log(effectiveChildren[0].items);
//        window.location.search= "page=1";
//        console.log(window.location.search);

      }

    });
  </script>
</dom-module>
